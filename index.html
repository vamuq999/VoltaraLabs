<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VoltaraLabs ‚Äî Mint Portal</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <style>
    :root { --bg:#0b0b0b; --fg:#00ffee; --muted:#0cd8bb; --card:#101214 }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--fg);font-family:Arial,Helvetica,sans-serif}
    .wrap{max-width:960px;margin:0 auto;padding:32px;min-height:100vh;display:flex;flex-direction:column;gap:20px}
    .hero{display:grid;place-items:center;text-align:center;padding:40px 12px;border-radius:20px;background:linear-gradient(180deg,#0b0b0b 0%,#0f1115 100%)}
    h1{font-size:44px;margin:6px 0 4px} p{opacity:.85;margin:0}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:820px){.grid{grid-template-columns:1.2fr .8fr}}
    .card{background:var(--card);border:1px solid #0f2b2b;border-radius:16px;padding:16px}
    label{font-size:12px;opacity:.9}
    input,select{width:100%;padding:12px 14px;border-radius:10px;border:1px solid #133;outline:none;background:#0b0d10;color:var(--fg)}
    input::placeholder{color:#73fff3aa}
    button{background:var(--fg);color:#003330;border:none;padding:12px 18px;border-radius:12px;font-weight:700;cursor:pointer}
    button:hover{background:var(--muted)}
    .row{display:flex;gap:10px;align-items:center}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px;word-break:break-all}
    .log{height:170px;overflow:auto;background:#080a0c;border:1px solid #123;border-radius:12px;padding:12px}
    .pill{padding:6px 10px;border-radius:999px;border:1px solid #164;display:inline-flex;gap:6px;align-items:center}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <h1>‚ö° VoltaraLabs ‚Äî Mint Portal ‚ö°</h1>
      <p>Connect wallet ‚Üí mint to the registered minter. Keep it simple, keep it sovereign.</p>
      <div style="margin-top:16px" class="row">
        <button id="connectBtn">Connect Wallet</button>
        <span id="acct" class="pill" style="display:none"></span>
        <span id="net" class="pill" style="display:none"></span>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h3 style="margin-top:0">1) Contract & Mint Settings</h3>
        <div style="display:grid;gap:12px">
          <div>
            <label>ERC-20/721 Minter Contract Address</label>
            <input id="contract" value="0x0148244a5e22dc39f14f12855247caa8320d7fb8"/>
          </div>

          <div class="row">
            <div style="flex:1">
              <label>Mint Amount (for contracts that require it)</label>
              <input id="amount" type="number" min="1" value="1"/>
            </div>
            <div style="flex:1">
              <label>ETH to Send (set your mint price per tx)</label>
              <input id="ethValue" type="text" value="0.001" />
            </div>
          </div>

          <div>
            <label>Mint Function Type</label>
            <select id="fnType">
              <option value="withAmount" selected>mint(uint256 amount) payable</option>
              <option value="noArg">mint() payable</option>
              <option value="auto">Auto-detect (try amount, then no-arg)</option>
            </select>
          </div>

          <div class="row">
            <button id="mintBtn">Mint</button>
            <button id="checkBtn" style="background:#1de9b6">Check Readiness</button>
            <button id="saveBtn" style="background:#14b8a6">Save Defaults</button>
          </div>
        </div>
      </div>

      <div class="card">
        <h3 style="margin-top:0">Console</h3>
        <div id="log" class="log mono"></div>
        <div style="margin-top:8px" class="mono" id="lastTx"></div>
      </div>
    </div>

    <div class="card">
      <h3 style="margin-top:0">Notes</h3>
      <ul>
        <li>Pre-filled with your minter address: <code class="mono">0x0148244a5e22dc39f14f12855247caa8320d7fb8</code>.</li>
        <li>Default function is <code>mint(uint256)</code>. If your contract is <code>mint()</code> without amount, select ‚Äúmint() payable‚Äù.</li>
        <li>Set the ETH value to your mint price; MetaMask will show the final gas + value.</li>
      </ul>
    </div>
  </div>

  <script>
    const $ = (s)=>document.querySelector(s);
    const log = (m)=>{ const el=$("#log"); el.innerHTML += m + "<br/>"; el.scrollTop=el.scrollHeight; };

    let provider, signer;

    // Persist your settings locally so they survive refresh
    function loadDefaults(){
      const d = JSON.parse(localStorage.getItem("mintDefaults")||"{}");
      if(d.contract) $("#contract").value = d.contract;
      if(d.amount) $("#amount").value = d.amount;
      if(d.ethValue) $("#ethValue").value = d.ethValue;
      if(d.fnType) $("#fnType").value = d.fnType;
    }
    function saveDefaults(){
      const d = {
        contract: $("#contract").value.trim(),
        amount: $("#amount").value.trim(),
        ethValue: $("#ethValue").value.trim(),
        fnType: $("#fnType").value
      };
      localStorage.setItem("mintDefaults", JSON.stringify(d));
      log("üíæ Defaults saved locally.");
    }

    function short(a){ return a ? a.slice(0,6)+"‚Ä¶"+a.slice(-4) : ""; }

    async function ensureWallet() {
      if (!window.ethereum) { alert("No wallet found. Install MetaMask."); throw new Error("No wallet"); }
      if (!provider) provider = new ethers.providers.Web3Provider(window.ethereum);
      if (!signer) {
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
      }
      const addr = await signer.getAddress();
      const network = await provider.getNetwork();
      $("#acct").style.display="inline-flex"; $("#acct").textContent = "Acct: "+short(addr);
      $("#net").style.display="inline-flex"; $("#net").textContent = "Chain: "+network.name+" ("+network.chainId+")";
      log("‚úÖ Wallet connected: "+addr);
      return { addr, network };
    }

    function getContract(address){
      const abi = [
        "function mint() payable",
        "function mint(uint256 amount) payable"
      ];
      return new ethers.Contract(address, abi, signer);
    }

    async function check(){
      try{
        await ensureWallet();
        const addr = $("#contract").value.trim();
        if(!addr) return alert("Enter a contract address first.");
        const code = await provider.getCode(addr);
        if(code === "0x") throw new Error("No contract at that address.");
        log("‚úÖ Contract code present at "+addr);
      }catch(e){ log("‚ùå "+(e.data?.message || e.message)); }
    }

    async function mint(){
      try{
        await ensureWallet();
        const caddr = $("#contract").value.trim();
        if(!caddr) return alert("Enter a contract address.");
        const contract = getContract(caddr);

        const valueEth = ($("#ethValue").value || "0").trim();
        const overrides = {};
        if (valueEth && valueEth !== "0") overrides.value = ethers.utils.parseEther(valueEth);

        const fnType = $("#fnType").value;
        const amt = Math.max(1, parseInt($("#amount").value || "1",10));

        let tx;
        if (fnType === "withAmount") {
          tx = await contract.mint(ethers.BigNumber.from(amt), overrides);
        } else if (fnType === "noArg") {
          tx = await contract.mint(overrides);
        } else {
          try { tx = await contract.mint(ethers.BigNumber.from(amt), overrides); }
          catch { tx = await contract.mint(overrides); }
        }

        log("‚õìÔ∏è  Submitted tx: "+tx.hash);
        $("#lastTx").textContent = "Last tx: "+tx.hash;
        const receipt = await tx.wait();
        log("‚úÖ Confirmed in block "+receipt.blockNumber);
      }catch(e){
        const msg = e.data?.message || e.message || String(e);
        log("‚ùå "+msg);
        if (msg.includes("user rejected")) log("‚ÑπÔ∏è You canceled the MetaMask prompt.");
      }
    }

    $("#connectBtn").onclick = ensureWallet;
    $("#checkBtn").onclick = check;
    $("#mintBtn").onclick = mint;
    $("#saveBtn").onclick = saveDefaults;

    loadDefaults();
  </script>
</body>
</html>
